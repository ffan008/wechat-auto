╔════════════════════════════════════════════════════════════════════════════╗
║                  微信公众号自动运营系统 - 系统概览                          ║
╚════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────┐
│                              系统架构                                     │
└─────────────────────────────────────────────────────────────────────────┘

    ┌──────────────┐
    │  微信平台     │
    └──────┬───────┘
           │ 消息推送
           ↓
    ┌──────────────┐
    │   Webhook    │  ← 签名验证、消息解析
    │  (FastAPI)   │
    └──────┬───────┘
           │
           ↓
    ┌─────────────────────────────────────┐
    │      LangGraph 工作流引擎            │
    └──────────────┬──────────────────────┘
                   │
                   ↓
         ┌─────────────────┐
         │ Coordinator Agent│  ← 意图识别、路由决策
         └─────────┬───────┘
                   │
      ┌────────────┼────────────┬────────────┐
      │            │            │            │
      ↓            ↓            ↓            ↓
┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐
│  Chat    │ │ Content  │ │Analytics │ │Scheduler │
│  Agent   │ │  Agent   │ │  Agent   │ │  Agent   │
└────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘
     │            │            │            │
     └────────────┼────────────┴────────────┘
                  │
      ┌───────────┴───────────┐
      │                       │
      ↓                       ↓
┌──────────┐           ┌──────────┐
│Claude AI │           │ PostgreSQL│
│(Anthropic│           │ + Redis   │
│  API)    │           └──────────┘
└──────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                              Agent说明                                    │
└─────────────────────────────────────────────────────────────────────────┘

🤖 Coordinator Agent (主控Agent)
   - 意图识别：理解用户想要做什么
   - 任务路由：将请求分发到合适的Agent
   - 特殊事件：处理关注、取消关注等事件

💬 Chat Agent (对话Agent)
   - FAQ匹配：快速回答常见问题
   - AI对话：使用Claude生成智能回复
   - 上下文记忆：记住对话历史
   - 用户画像：自动更新用户信息

📝 Content Agent (内容Agent)
   - 大纲生成：规划文章结构
   - 内容撰写：AI生成正文
   - 标题优化：提供多个标题选项（A/B测试）
   - 草稿管理：保存到数据库

📊 Analytics Agent (分析Agent)
   - 数据采集：从微信API获取数据
   - 指标计算：计算KPI（阅读量、互动率等）
   - 洞察生成：AI分析数据趋势
   - 报告生成：自动生成运营报告

⏰ Scheduler Agent (调度Agent)
   - 内容调度：安排发布时间
   - 内容日历：生成周度/月度计划
   - 最佳时间：预测最佳发布时间
   - 任务管理：管理待发布内容

┌─────────────────────────────────────────────────────────────────────────┐
│                            数据流程                                      │
└─────────────────────────────────────────────────────────────────────────┘

1. 用户消息 → 微信平台 → Webhook接收
2. 签名验证 → XML解析 → 提取消息内容
3. LangGraph工作流启动
4. Coordinator Agent识别意图
5. 路由到相应Agent处理
6. Agent调用Claude AI生成回复
7. 保存对话历史（Redis + PostgreSQL）
8. 更新用户画像
9. 构建XML响应
10. 返回给微信平台
11. 推送给用户

┌─────────────────────────────────────────────────────────────────────────┐
│                          定时任务                                        │
└─────────────────────────────────────────────────────────────────────────┘

📅 每小时任务
   - 采集微信数据（粉丝数、阅读量等）
   - 更新Redis缓存

📊 每日任务 (08:00)
   - 生成每日数据报告
   - 更新用户画像
   - 计算RFM分层

📝 每10分钟
   - 检查待发布内容
   - 自动发布到微信

🔥 每30分钟
   - 监控热点话题
   - 更新热点缓存

┌─────────────────────────────────────────────────────────────────────────┐
│                          核心技术栈                                      │
└─────────────────────────────────────────────────────────────────────────┘

• Python 3.10+        - 编程语言
• FastAPI             - Web框架
• LangGraph           - 多Agent协作框架
• Claude 3.5 Sonnet   - AI大模型
• PostgreSQL          - 关系数据库
• Redis               - 缓存数据库
• Celery              - 任务队列
• WeChatPy            - 微信SDK
• Docker              - 容器化
• Nginx               - 反向代理

┌─────────────────────────────────────────────────────────────────────────┐
│                          使用示例                                        │
└─────────────────────────────────────────────────────────────────────────┘

💬 对话示例
   用户: "你好"
   系统: "欢迎关注我们的公众号！🎉 我是AI助手..."

📝 内容生成示例
   用户: "帮我写一篇关于AI的文章"
   系统: "内容已生成！📝\n\n标题选项：\n1. AI正在改变..."

📊 数据分析示例
   用户: "查看本周数据"
   系统: "数据分析报告 📊\n\n核心指标：\n• 新增粉丝..."

⏰ 调度发布示例
   用户: "把草稿1定在明天晚上8点发布"
   系统: "内容发布已调度！✅\n\n内容ID: 1\n发布时间..."

┌─────────────────────────────────────────────────────────────────────────┐
│                        快速开始                                          │
└─────────────────────────────────────────────────────────────────────────┘

1. 安装:     ./install.sh
2. 配置:     编辑 .env 文件
3. 启动:     docker-compose up -d
4. 测试:     python test_system.py
5. 配置微信: 设置服务器URL为 https://your-domain.com/api/wechat/webhook

┌─────────────────────────────────────────────────────────────────────────┐
│                        文档说明                                          │
└─────────────────────────────────────────────────────────────────────────┘

• README.md              - 完整项目文档
• QUICKSTART.md          - 快速开始指南
• DEPLOYMENT_CHECKLIST.md - 部署检查清单
• IMPLEMENTATION_SUMMARY.md - 实施总结
• config/config.yaml     - 主配置文件
• config/prompts.yaml    - AI提示词配置

╔════════════════════════════════════════════════════════════════════════════╗
║  🎉 系统已完全实现，可立即部署使用！                                       ║
╚════════════════════════════════════════════════════════════════════════════╝
